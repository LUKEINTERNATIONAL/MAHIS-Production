import{d as X,r as i,aO as Y,c as Z,a as ee,H as ae,O as se,f as m,J as n,l as o,u as s,a4 as oe,k as l,aS as te,aP as le,e as I,m as q,dw as ne,E as re,Q as g,K as L,b2 as P,X as y,cJ as O,bx as ie,c1 as S,c0 as U,N as $,bs as M,p as c,a7 as ue}from"./vendor--U51omhD.js";import{x as B,a2 as K,t as C,U as de,K as ce,a3 as z,s as v,a4 as ve,a5 as we,a6 as pe,a1 as fe,y as me,a7 as ge,_ as Pe}from"./index-8iVV3ldc.js";import{i as ye}from"./Img-CJEgX1Vr.js";import{p as Ie,g as Ce}from"./userService-BIwqN_4o.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BsrFsgT4.js";const _e={class:"login-container"},be={key:0,style:{"justify-content":"center",display:"block"}},ke={style:{"font-size":"15px"}},he={style:{"font-size":"12px",color:"#34af4d"}},xe={key:1},Se={style:{"font-size":"15px"}},Ue={key:0},Ee={style:{"text-align":"left"}},Ne={class:"signup-link"},qe={key:1},Le={style:{"text-align":"left"}},Me={key:0,class:"password-requirements"},ze={class:"requirements-list"},Ae={class:"signup-link"},Fe=X({__name:"Login",setup(Oe){const w=i(""),p=i(""),E=i(""),_=i(!1),f=i(!1),N=i("production"),u=i(new ge),a=i({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),b=i(!1),k=i(!1),h=i(!1),R=Y(),V=B(),A=Z(()=>a.value.username.trim()!==""&&a.value.currentPassword.trim()!==""&&a.value.newPassword.trim()!==""&&a.value.confirmPassword.trim()!==""&&K(a.value.newPassword)&&a.value.newPassword===a.value.confirmPassword&&a.value.newPassword!==a.value.currentPassword),D=async()=>{V.terminate(),await B().postData("SET_OFFLINE_PROGRAMS")},H=()=>{E.value=localStorage.getItem("core_version")||""},T=async()=>{const t=fe(),e=await Ce();e&&(t.setUserFacilityName(e.name),t.setFacilityLocation(e),localStorage.setItem("facility_code",e.code))},J=async()=>{const t=await u.value.checkUserPrograms(void 0);t!=null&&t.programs&&me().setAuthorizedPrograms(t==null?void 0:t.programs)},x=()=>{f.value=!f.value,f.value&&(a.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},W=()=>{C("Help functionality to be implemented")},j=async()=>{if(!A.value){C("Please complete all fields correctly"),C("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");return}try{const t=await u.value.requestLogin(a.value.currentPassword,a.value.username);if(t){const{authorization:e}=t,{token:d,user:r}=e;r&&(localStorage.setItem("apiKey",d),await de.updateUser(r.user_id,{password:a.value.newPassword}),ce("Password changed successfully!"),await u.value.requestLogin(a.value.newPassword,a.value.username),a.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},f.value=!1,localStorage.setItem("apiKey",""))}}catch(t){t instanceof z?v("Current password is incorrect"):v("Error changing password: ".concat(t))}},G=async()=>{if(w.value&&p.value){u.value.setUsername(w.value);try{await u.value.login(p.value),await T(),await J(),await ve(),await Ie(),R.push("/home")}catch(t){t instanceof z&&v("Invalid username or password"),t instanceof we&&(x(),v("Please change your password",5e4)),t instanceof pe?(x(),v("Your password has expired. Please change your password",5e4)):v("".concat(t),5e4)}}else C("Complete form to log in")},Q=async()=>{if(w.value&&p.value){u.value.setUsername(w.value);try{await u.value.loginToMIUM(p.value)}catch(t){t instanceof z&&v("Invalid username or password")}}else C("Complete form to log in")},F=async()=>{await G(),await Q()};return ee(async()=>{localStorage.setItem("apiKey",""),await u.value.loadConfig(),H(),await D()}),(t,e)=>{const d=ae("ion-icon");return m(),se(s(ue),null,{default:n(()=>[o(s(oe),{class:"ion-padding login-page"},{default:n(()=>[l("div",_e,[o(s(te),{style:{"background-color":"#fff"}},{default:n(()=>[o(s(le),null,{default:n(()=>[o(s(ne),{class:"login_img",src:s(ye)("mw.png"),id:"logo"},null,8,["src"]),o(s(re),{class:"login-title"},{default:n(()=>[N.value==="development"||N.value==="test"?(m(),I("span",be,[l("div",null,[e[10]||(e[10]=g(" MaHIS ",-1)),l("small",ke,"(v"+L(E.value)+")",1)]),l("div",he,"("+L(N.value)+")",1)])):(m(),I("span",xe,[e[11]||(e[11]=g(" MaHIS ",-1)),l("small",Se,"(v"+L(E.value)+")",1)]))]),_:1}),f.value?q("",!0):(m(),I("div",Ue,[l("span",Ee,[o(s(P),{value:w.value,onIonInput:e[0]||(e[0]=r=>w.value=r.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:n(()=>[o(s(y),{slot:"end"},{default:n(()=>[o(d,{icon:s(O)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),o(s(P),{value:p.value,onIonInput:e[2]||(e[2]=r=>p.value=r.target.value||""),type:_.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:ie(F,["enter"])},{default:n(()=>[o(s(y),{slot:"end"},{default:n(()=>[o(d,{icon:_.value?s(S):s(U),onClick:e[1]||(e[1]=r=>_.value=!_.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),o(s($),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:F,class:"login-button"},{default:n(()=>[...e[12]||(e[12]=[g(" Login ",-1)])]),_:1}),l("p",Ne,[e[13]||(e[13]=g(" For help click ",-1)),l("a",{href:"#",onClick:M(W,["prevent"])},"Here"),e[14]||(e[14]=g(" | ",-1)),l("a",{href:"#",onClick:M(x,["prevent"])},"Change Password")])])),f.value?(m(),I("div",qe,[e[17]||(e[17]=l("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),l("span",Le,[o(s(P),{value:a.value.username,onIonInput:e[3]||(e[3]=r=>a.value.username=r.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:n(()=>[o(s(y),{slot:"end"},{default:n(()=>[o(d,{icon:s(O)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),o(s(P),{value:a.value.currentPassword,onIonInput:e[5]||(e[5]=r=>a.value.currentPassword=r.target.value||""),type:b.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:n(()=>[o(s(y),{slot:"end"},{default:n(()=>[o(d,{icon:b.value?s(S):s(U),onClick:e[4]||(e[4]=r=>b.value=!b.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),o(s(P),{value:a.value.newPassword,onIonInput:e[7]||(e[7]=r=>a.value.newPassword=r.target.value||""),type:k.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:c(["input-fields",{"invalid-input":a.value.newPassword&&!s(K)(a.value.newPassword)}]),required:""},{default:n(()=>[o(s(y),{slot:"end"},{default:n(()=>[o(d,{icon:k.value?s(S):s(U),onClick:e[6]||(e[6]=r=>k.value=!k.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),o(s(P),{value:a.value.confirmPassword,onIonInput:e[9]||(e[9]=r=>a.value.confirmPassword=r.target.value||""),type:h.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:c(["input-fields",{"invalid-input":a.value.confirmPassword&&a.value.newPassword!==a.value.confirmPassword}]),required:""},{default:n(()=>[o(s(y),{slot:"end"},{default:n(()=>[o(d,{icon:h.value?s(S):s(U),onClick:e[8]||(e[8]=r=>h.value=!h.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),a.value.newPassword?(m(),I("div",Me,[e[15]||(e[15]=l("p",{class:"requirements-title"},"Password Requirements:",-1)),l("ul",ze,[l("li",{class:c({valid:a.value.newPassword.length>=8})},"At least 8 characters",2),l("li",{class:c({valid:/[A-Z]/.test(a.value.newPassword)})},"One uppercase letter",2),l("li",{class:c({valid:/[0-9]/.test(a.value.newPassword)})},"One number",2),l("li",{class:c({valid:/[@#$%^&+=*!-]/.test(a.value.newPassword)})},"One special character (@#$%^&+=*!-)",2),l("li",{class:c({valid:a.value.newPassword!==a.value.currentPassword&&a.value.currentPassword!==""})},"Different from current password",2)])])):q("",!0),o(s($),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:j,class:"login-button",disabled:!A.value},{default:n(()=>[...e[16]||(e[16]=[g(" Change Password ",-1)])]),_:1},8,["disabled"]),l("p",Ae,[l("a",{href:"#",onClick:M(x,["prevent"])},"Back to Login")])])):q("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),He=Pe(Fe,[["__scopeId","data-v-f7cf51d7"]]);export{He as default};
