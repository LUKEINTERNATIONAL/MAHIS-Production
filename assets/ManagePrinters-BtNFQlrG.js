import{d as J,c as w,O as S,f,J as i,l as r,u as s,I as Q,G as Z,k as o,E as Y,Q as h,a4 as X,a5 as M,a6 as V,a7 as q,R,cn as K,r as y,w as j,a as G,e as $,b6 as ee,n as te,m as A,bO as ne,$ as z,X as U,d8 as ae,aj as se,F as re,P as oe,K as ie,N as W,p as le}from"./vendor--U51omhD.js";import{k as D,aA as N,M as E,aB as H,S as k,_ as B,n as de,s as T,K as O,aC as ue,T as ce}from"./index-8iVV3ldc.js";import{u as pe}from"./useExposeFromStandardForm-C25sGSah.js";import{u as fe}from"./useLocation-BdrAUPWl.js";import"./lodash-NJiRuGo9.js";import"./apexcharts-BsrFsgT4.js";const me={style:{display:"flex","justify-content":"space-between"}},_e={style:{"max-width":"500px",margin:"auto"}},ge=J({__name:"AddWebPrinter",setup(L){const{formRef:m}=pe(),{facilityList:g,getFacilities:_}=fe();_();const c=w(()=>[{componentType:"inputField",header:"Print name",name:"printer_name",icon:D.print,validation:d=>N.required(d)},{componentType:"inputField",header:"Printer IP address",name:"ip_address",icon:D.networkBarDark,validation:d=>N.required(d)},{componentType:"multiSelectInputField",header:"Facility",name:"location_id",trackBy:"facility_id",openDirection:"auto",icon:D.search,validation:d=>N.required(d),options:g.value.facilities}]),v=()=>{R.dismiss()},p=()=>{var u;const d=(u=m.value)==null?void 0:u.getFormValues();d.location_id=d.location_id.code,k.postJson("/printer_configurations",d),R.dismiss()};return(d,u)=>(f(),S(s(q),null,{default:i(()=>[r(s(Q),null,{default:i(()=>[r(s(Z),null,{default:i(()=>[o("div",me,[r(s(Y),null,{default:i(()=>[...u[2]||(u[2]=[h("Add Web Printer",-1)])]),_:1}),r(E,{name:"X",style:{"margin-right":"10px"},onClick:u[0]||(u[0]=P=>v())})])]),_:1})]),_:1}),r(s(X),{class:"ion-padding"},{default:i(()=>[o("div",_e,[r(s(M),null,{default:i(()=>[r(s(V),{size:"12"},{default:i(()=>[r(H,{formData:c.value,ref_key:"formRef",ref:m},null,8,["formData"])]),_:1})]),_:1}),r(s(M),{class:"ion-justify-content-end ion-margin-top"},{default:i(()=>[r(s(V),{size:"auto"},{default:i(()=>[r(E,{name:"Add printer",onClick:u[1]||(u[1]=P=>p())})]),_:1})]),_:1})])]),_:1})]),_:1}))}}),ve=B(ge,[["__scopeId","data-v-bce6abd1"]]),ye={class:""},Pe={class:"table-header",style:{display:"flex","justify-content":"space-between","align-items":"center"}},be={style:{"min-width":"400px",display:"flex","align-items":"center"}},Ie={class:"table-responsive"},ke={key:0,class:"loading-state"},Se={key:1,class:"empty-state"},we=J({__name:"ManageIPPrinters",setup(L){const m=K(),g=y([]),_=y(!1),c=y(null),v=w(()=>({paging:!0,lengthChange:!1,searching:!1,ordering:!0,info:!0,autoWidth:!0,responsive:!0,pageLength:8})),p=w(()=>[{data:0,title:"Printer name"},{data:1,title:"Ip address"},{data:2,title:"Date"},{data:3,title:"Actions",orderable:!1,className:"text-left"}]),d=w(()=>[{componentType:"multiSelectInputField",value:k.getDefaultPrinter()||"",trackBy:"id",onChange:e=>{localStorage.setItem("defaultPrinter",JSON.stringify(e))},options:g.value.map(e=>({name:e.printer_name,id:e._id,ip_address:e.ip_address}))}]),u=w(()=>P(g.value)),P=e=>e.length>0?e.map(t=>[t.printer_name,t.ip_address,t.created_at,'<div class="action-buttons">\n                    <button class="test-print-btn action-button" data-id=\''.concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Test Print</button>\n                    <button class=\"edit-btn action-button\" data-id='").concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Edit</button>\n                    <button class=\"delete-btn action-button delete-button\" data-id='").concat(JSON.stringify({id:t._id,printer_name:t.printer_name,ip_address:t.ip_address,created_at:t.created_at,location_id:t.location_id}),"'>Delete</button>\n                </div>")]):[],b=()=>{te(()=>{const e=c.value.dt;e.columns.adjust().draw(),e.off("click",".test-print-btn"),e.off("click",".edit-btn"),e.off("click",".delete-btn"),e.on("click",".test-print-btn",t=>{const l=t.target.getAttribute("data-id");n(JSON.parse(l))}),e.on("click",".edit-btn",t=>{const l=t.target.getAttribute("data-id");I(JSON.parse(l))}),e.on("click",".delete-btn",t=>{const l=t.target.getAttribute("data-id");x(JSON.parse(l))})})},F=async(e=null)=>{await de(ve,{class:"large-modal"},!0),await a()},I=async e=>{console.log("Editing printer:",e),O("Edit functionality for ".concat(e.printer_name," is under development."))},x=async e=>{if(confirm("Are you sure you want to delete printer: ".concat(e.printer_name,"?")))try{await k.delete("/printer_configurations/".concat(e.id),{id:e.id}),O("Printer ".concat(e.printer_name," deleted successfully!")),await a()}catch(t){console.error("Error deleting printer:",t),T("Failed to delete printer ".concat(e.printer_name,"."))}},n=async e=>{const t="^XA\n        ^FO50,50^A0N,60,60^FDTest Print from Vue App!^FS\n        ^FO50,150^A0N,30,30^FDPrinter: ".concat(e.printer_name,"^FS\n        ^FO50,200^A0N,30,30^FDIP Address: ").concat(e.ip_address,"^FS\n        ^XZ");try{const l=await fetch("https://".concat(e.ip_address,"/print"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({zpl:t})});if(l.ok)O("Test print sent successfully to ".concat(e.printer_name));else{const C=await l.json();T("Failed to send test print to ".concat(e.printer_name,". Error: ").concat(C.message||l.statusText))}}catch(l){console.error("Error sending test print:",l),T("Error sending test print to ".concat(e.printer_name,". Please check your network or server connection."))}},a=async()=>{_.value=!0;try{g.value=await k.getJson("/printer_configurations",{location_id:k.getUserLocationId()}),b()}catch(e){console.error("Error loading printer configurations:",e),T("Failed to load printer configurations.")}finally{_.value=!1}};return j(m,async()=>{await a()},{deep:!0}),j(u,()=>{b()}),G(async()=>{k.getDefaultPrinter(),await a()}),(e,t)=>(f(),$("div",ye,[o("div",null,[o("div",Pe,[t[2]||(t[2]=o("h3",{class:"encounter-title"},"Manage web printers",-1)),o("div",be,[t[1]||(t[1]=o("span",{style:{"font-weight":"700"}},"Default Printer",-1)),r(H,{formData:d.value,ref:"formRef"},null,8,["formData"])]),r(E,{name:"Add printer",fill:"solid",onClick:t[0]||(t[0]=l=>F())})]),o("div",Ie,[_.value?(f(),$("div",ke,[...t[3]||(t[3]=[o("p",null,"Loading printers...",-1)])])):g.value.length===0?(f(),$("div",Se,[...t[4]||(t[4]=[o("p",null,"No printers found",-1)])])):(f(),S(s(ee),{key:2,ref_key:"dataTableRef",ref:c,class:"display nowrap modern-table",width:"100%",data:u.value,columns:p.value,options:v.value},{default:i(()=>[...t[5]||(t[5]=[o("thead",null,[o("tr",null,[o("th",null,"Printer name"),o("th",null,"Ip address"),o("th",null,"Date"),o("th",null,"Actions")])],-1)])]),_:1},8,["data","columns","options"]))])])]))}}),he=B(we,[["__scopeId","data-v-0bd9302e"]]),$e={key:0,class:"spinner-overlay"},Te={class:"container"},Fe=J({__name:"ManagePrinters",setup(L){K();const m=y(!1),g=y(Math.random()),_=y([]),c=y({}),v=new ue,p=y(!1);function d(){try{localStorage.setItem("isIpPrinters",JSON.stringify(p.value)),console.log("isIpPrinters state saved:",p.value)}catch(n){console.error("Error saving isIpPrinters state to localStorage:",n)}}function u(){try{const n=localStorage.getItem("isIpPrinters");n!==null&&(p.value=JSON.parse(n),console.log("isIpPrinters state loaded:",p.value))}catch(n){console.error("Error loading isIpPrinters state from localStorage:",n)}}async function P(){if(!m.value){m.value=!0;try{const n=await v.getAllPrinters();console.log("Discovered printers",JSON.stringify(n)),_.value=x(n)}catch(n){console.error("Error loading printers:",n)}finally{m.value=!1,g.value=Math.random()}}}function b(n,a){const e=n.name||"",t=a.name||"",l=n.address||"",C=a.address||"";return e!==t?e.localeCompare(t):l.localeCompare(C)}function F(n){v.setDefaultPrinter(n),c.value=n,g.value=Math.random(),P()}function I(n){return b(n,c.value)===0}function x(n){return n.sort((a,e)=>{const t=I(a),l=I(e);return t&&!l?-1:!t&&l?1:b(a,e)})}return G(async()=>{u(),c.value=await v.getDefaultPrinter()||{},c.value&&(c.value.name||c.value.address)&&(_.value.some(a=>b(a,c.value)===0)||_.value.push(c.value)),P()}),(n,a)=>(f(),S(s(q),{class:le({loading:m.value})},{default:i(()=>[m.value?(f(),$("div",$e,[r(s(ne),{name:"bubbles"}),a[1]||(a[1]=o("div",{class:"loading-text"},"Please wait...",-1))])):A("",!0),r(ce),r(s(X),null,{default:i(()=>[o("div",Te,[a[5]||(a[5]=o("h4",{style:{width:"100%","text-align":"center","font-weight":"700"}},"Printer Management",-1)),r(s(z),null,{default:i(()=>[r(s(U),null,{default:i(()=>[...a[2]||(a[2]=[h("Use IP Printers",-1)])]),_:1}),r(s(ae),{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),onIonChange:d},null,8,["modelValue"])]),_:1}),p.value?A("",!0):(f(),S(s(se),{key:0},{default:i(()=>[(f(!0),$(re,null,oe(_.value,e=>(f(),S(s(z),{key:e.name||e.address||"unknown-printer"},{default:i(()=>[r(s(U),null,{default:i(()=>[h(ie(e.name||e.address||"Unnamed Printer"),1)]),_:2},1024),r(s(W),{size:"small",color:I(e)?"success":"primary",onClick:t=>F(e),disabled:I(e)},{default:i(()=>[...a[3]||(a[3]=[h(" Set as Default ",-1)])]),_:1},8,["color","onClick","disabled"]),r(s(W),{onClick:t=>s(v).printTestLbl(e),size:"small"},{default:i(()=>[...a[4]||(a[4]=[h(" Test Print ",-1)])]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1})),p.value?(f(),S(he,{key:1,style:{"margin-top":"10px"}})):A("",!0)])]),_:1})]),_:1},8,["class"]))}}),Ee=B(Fe,[["__scopeId","data-v-94d8d5a1"]]);export{Ee as default};
