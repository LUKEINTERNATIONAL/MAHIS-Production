System.register(["./vendor-legacy-Cf-ayshu.js","./index-legacy-BB0b2PHr.js","./Img-legacy-BNmikZ_d.js","./userService-legacy-DAi_b55P.js","./lodash-legacy-pOOc9Efu.js","./apexcharts-legacy-KJXhmJQp.js"],function(e,a){"use strict";var l,t,n,s,o,r,i,u,d,c,f,v,p,w,g,m,y,P,x,b,h,k,_,I,C,q,z,S,U,E,j,L,N,O,H,K,$,F,M,R,A,D,J,T,B,G,Q,X;return{setters:[e=>{l=e.d,t=e.r,n=e.aO,s=e.c,o=e.a,r=e.H,i=e.O,u=e.f,d=e.J,c=e.l,f=e.u,v=e.a4,p=e.k,w=e.aS,g=e.aP,m=e.e,y=e.m,P=e.dw,x=e.E,b=e.Q,h=e.K,k=e.b2,_=e.X,I=e.cJ,C=e.bx,q=e.c1,z=e.c0,S=e.N,U=e.bs,E=e.p,j=e.a7},e=>{L=e.x,N=e.a2,O=e.t,H=e.U,K=e.K,$=e.a3,F=e.s,M=e.a4,R=e.a5,A=e.a6,D=e.a1,J=e.y,T=e.a7,B=e._},e=>{G=e.i},e=>{Q=e.p,X=e.g},null,null],execute:function(){var a=document.createElement("style");a.textContent='.login-page[data-v-f7cf51d7]{background-color:#fff}.login-container[data-v-f7cf51d7]{display:flex;justify-content:center;align-items:center;text-align:center;height:90vh}.login-title[data-v-f7cf51d7]{font-size:24px;margin-bottom:30px;font-weight:700;margin-top:20px}.input-fields[data-v-f7cf51d7]{margin-bottom:35px}.invalid-input[data-v-f7cf51d7]{--border-color: #ff4444 !important;--color: #ff4444 !important}.password-requirements[data-v-f7cf51d7]{text-align:left;margin-bottom:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #34af4d}.requirements-title[data-v-f7cf51d7]{margin:0 0 10px;font-weight:600;color:#333;font-size:14px}.requirements-list[data-v-f7cf51d7]{margin:0;padding-left:20px;list-style:none}.requirements-list li[data-v-f7cf51d7]{margin-bottom:5px;font-size:13px;color:#666;position:relative}.requirements-list li[data-v-f7cf51d7]:before{content:"✗";color:#f44;font-weight:700;position:absolute;left:-20px}.requirements-list li.valid[data-v-f7cf51d7]:before{content:"✓";color:#34af4d}.requirements-list li.valid[data-v-f7cf51d7]{color:#34af4d}.password-toggle[data-v-f7cf51d7]{cursor:pointer;position:absolute;margin-top:-73px;margin-left:130px;z-index:1000}.login-button[data-v-f7cf51d7]{color:#fff;margin-top:30px}.login-button[data-v-f7cf51d7]:disabled{opacity:.5;cursor:not-allowed}.signup-link[data-v-f7cf51d7]{margin-top:50px}.signup-link a[data-v-f7cf51d7]{text-decoration:underline;color:#34af4d;cursor:pointer}.signup-link a[data-v-f7cf51d7]:hover{color:#2d8f3f}.password-toggle[data-v-f7cf51d7]{font-size:20px}.login_img[data-v-f7cf51d7]{width:90px;margin:auto}ion-card[data-v-f7cf51d7]{min-width:330px}@media (max-width: 902px){.login-page[data-v-f7cf51d7]{--ion-background-color: #ffffff}ion-card[data-v-f7cf51d7]{box-shadow:unset}}\n/*$vite$:1*/',document.head.appendChild(a);const Y={class:"login-container"},Z={key:0,style:{"justify-content":"center",display:"block"}},V={style:{"font-size":"15px"}},W={style:{"font-size":"12px",color:"#34af4d"}},ee={key:1},ae={style:{"font-size":"15px"}},le={key:0},te={style:{"text-align":"left"}},ne={class:"signup-link"},se={key:1},oe={style:{"text-align":"left"}},re={key:0,class:"password-requirements"},ie={class:"requirements-list"},ue={class:"signup-link"};e("default",B(l({__name:"Login",setup(e){const a=t(""),l=t(""),B=t(""),de=t(!1),ce=t(!1),fe=t("production"),ve=t(new T),pe=t({username:"",currentPassword:"",newPassword:"",confirmPassword:""}),we=t(!1),ge=t(!1),me=t(!1),ye=n(),Pe=L(),xe=s(()=>""!==pe.value.username.trim()&&""!==pe.value.currentPassword.trim()&&""!==pe.value.newPassword.trim()&&""!==pe.value.confirmPassword.trim()&&N(pe.value.newPassword)&&pe.value.newPassword===pe.value.confirmPassword&&pe.value.newPassword!==pe.value.currentPassword),be=()=>{ce.value=!ce.value,ce.value&&(pe.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""})},he=()=>{O("Help functionality to be implemented")},ke=async()=>{if(!xe.value)return O("Please complete all fields correctly"),void O("Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character.");try{const e=await ve.value.requestLogin(pe.value.currentPassword,pe.value.username);if(e){const{authorization:a}=e,{token:l,user:t}=a;t&&(localStorage.setItem("apiKey",l),await H.updateUser(t.user_id,{password:pe.value.newPassword}),K("Password changed successfully!"),await ve.value.requestLogin(pe.value.newPassword,pe.value.username),pe.value={username:"",currentPassword:"",newPassword:"",confirmPassword:""},ce.value=!1,localStorage.setItem("apiKey",""))}}catch(e){F(e instanceof $?"Current password is incorrect":`Error changing password: ${e}`)}},_e=async()=>{if(a.value&&l.value){ve.value.setUsername(a.value);try{await ve.value.login(l.value),await(async()=>{const e=D(),a=await X();a&&(e.setUserFacilityName(a.name),e.setFacilityLocation(a),localStorage.setItem("facility_code",a.code))})(),await(async()=>{const e=await ve.value.checkUserPrograms(void 0);null!=e&&e.programs&&J().setAuthorizedPrograms(null==e?void 0:e.programs)})(),await M(),await Q(),ye.push("/home")}catch(e){e instanceof $&&F("Invalid username or password"),e instanceof R&&(be(),F("Please change your password",5e4)),e instanceof A?(be(),F("Your password has expired. Please change your password",5e4)):F(`${e}`,5e4)}}else O("Complete form to log in")},Ie=async()=>{await _e(),await(async()=>{if(a.value&&l.value){ve.value.setUsername(a.value);try{await ve.value.loginToMIUM(l.value)}catch(e){e instanceof $&&F("Invalid username or password")}}else O("Complete form to log in")})()};return o(async()=>{localStorage.setItem("apiKey",""),await ve.value.loadConfig(),B.value=localStorage.getItem("core_version")||"",await(async()=>{Pe.terminate(),await L().postData("SET_OFFLINE_PROGRAMS")})()}),(e,t)=>{const n=r("ion-icon");return u(),i(f(j),null,{default:d(()=>[c(f(v),{class:"ion-padding login-page"},{default:d(()=>[p("div",Y,[c(f(w),{style:{"background-color":"#fff"}},{default:d(()=>[c(f(g),null,{default:d(()=>[c(f(P),{class:"login_img",src:f(G)("mw.png"),id:"logo"},null,8,["src"]),c(f(x),{class:"login-title"},{default:d(()=>["development"===fe.value||"test"===fe.value?(u(),m("span",Z,[p("div",null,[t[10]||(t[10]=b(" MaHIS ",-1)),p("small",V,"(v"+h(B.value)+")",1)]),p("div",W,"("+h(fe.value)+")",1)])):(u(),m("span",ee,[t[11]||(t[11]=b(" MaHIS ",-1)),p("small",ae,"(v"+h(B.value)+")",1)]))]),_:1}),ce.value?y("",!0):(u(),m("div",le,[p("span",te,[c(f(k),{value:a.value,onIonInput:t[0]||(t[0]=e=>a.value=e.target.value||""),type:"text",label:"Username",ref:"usernameRef","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:d(()=>[c(f(_),{slot:"end"},{default:d(()=>[c(n,{icon:f(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),c(f(k),{value:l.value,onIonInput:t[2]||(t[2]=e=>l.value=e.target.value||""),type:de.value?"text":"password",label:"Password",ref:"passwordRef","label-placement":"floating",fill:"outline",placeholder:"Enter Password",class:"input-fields",required:"",onKeydown:C(Ie,["enter"])},{default:d(()=>[c(f(_),{slot:"end"},{default:d(()=>[c(n,{icon:de.value?f(q):f(z),onClick:t[1]||(t[1]=e=>de.value=!de.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"])]),c(f(S),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:Ie,class:"login-button"},{default:d(()=>[...t[12]||(t[12]=[b(" Login ",-1)])]),_:1}),p("p",ne,[t[13]||(t[13]=b(" For help click ",-1)),p("a",{href:"#",onClick:U(he,["prevent"])},"Here"),t[14]||(t[14]=b(" | ",-1)),p("a",{href:"#",onClick:U(be,["prevent"])},"Change Password")])])),ce.value?(u(),m("div",se,[t[17]||(t[17]=p("h3",{style:{"text-align":"center","margin-bottom":"20px",color:"#34af4d"}},"Change Password",-1)),p("span",oe,[c(f(k),{value:pe.value.username,onIonInput:t[3]||(t[3]=e=>pe.value.username=e.target.value||""),type:"text",label:"Username","label-placement":"floating",fill:"outline",placeholder:"Enter Username",class:"input-fields",required:""},{default:d(()=>[c(f(_),{slot:"end"},{default:d(()=>[c(n,{icon:f(I)},null,8,["icon"])]),_:1})]),_:1},8,["value"]),c(f(k),{value:pe.value.currentPassword,onIonInput:t[5]||(t[5]=e=>pe.value.currentPassword=e.target.value||""),type:we.value?"text":"password",label:"Current Password","label-placement":"floating",fill:"outline",placeholder:"Enter Current Password",class:"input-fields",required:""},{default:d(()=>[c(f(_),{slot:"end"},{default:d(()=>[c(n,{icon:we.value?f(q):f(z),onClick:t[4]||(t[4]=e=>we.value=!we.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type"]),c(f(k),{value:pe.value.newPassword,onIonInput:t[7]||(t[7]=e=>pe.value.newPassword=e.target.value||""),type:ge.value?"text":"password",label:"New Password","label-placement":"floating",fill:"outline",placeholder:"Enter New Password",class:E(["input-fields",{"invalid-input":pe.value.newPassword&&!f(N)(pe.value.newPassword)}]),required:""},{default:d(()=>[c(f(_),{slot:"end"},{default:d(()=>[c(n,{icon:ge.value?f(q):f(z),onClick:t[6]||(t[6]=e=>ge.value=!ge.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"]),c(f(k),{value:pe.value.confirmPassword,onIonInput:t[9]||(t[9]=e=>pe.value.confirmPassword=e.target.value||""),type:me.value?"text":"password",label:"Confirm New Password","label-placement":"floating",fill:"outline",placeholder:"Confirm New Password",class:E(["input-fields",{"invalid-input":pe.value.confirmPassword&&pe.value.newPassword!==pe.value.confirmPassword}]),required:""},{default:d(()=>[c(f(_),{slot:"end"},{default:d(()=>[c(n,{icon:me.value?f(q):f(z),onClick:t[8]||(t[8]=e=>me.value=!me.value)},null,8,["icon"])]),_:1})]),_:1},8,["value","type","class"])]),pe.value.newPassword?(u(),m("div",re,[t[15]||(t[15]=p("p",{class:"requirements-title"},"Password Requirements:",-1)),p("ul",ie,[p("li",{class:E({valid:pe.value.newPassword.length>=8})},"At least 8 characters",2),p("li",{class:E({valid:/[A-Z]/.test(pe.value.newPassword)})},"One uppercase letter",2),p("li",{class:E({valid:/[0-9]/.test(pe.value.newPassword)})},"One number",2),p("li",{class:E({valid:/[@#$%^&+=*!-]/.test(pe.value.newPassword)})},"One special character (@#$%^&+=*!-)",2),p("li",{class:E({valid:pe.value.newPassword!==pe.value.currentPassword&&""!==pe.value.currentPassword})},"Different from current password",2)])])):y("",!0),c(f(S),{expand:"block",style:{"--background":"var(--ion-color-primary)","font-size":"var(--ion-button-font)"},onClick:ke,class:"login-button",disabled:!xe.value},{default:d(()=>[...t[16]||(t[16]=[b(" Change Password ",-1)])]),_:1},8,["disabled"]),p("p",ue,[p("a",{href:"#",onClick:U(be,["prevent"])},"Back to Login")])])):y("",!0)]),_:1})]),_:1})])]),_:1})]),_:1})}}}),[["__scopeId","data-v-f7cf51d7"]]))}}});
